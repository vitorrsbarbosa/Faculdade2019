/*
ALTER TABLE PEDIDO ADD VALORDESCONTO NUMBER(9,2);
SELECT * FROM PEDIDO;
SELECT * FROM ITEMPEDIDO WHERE CODPEDIDO = 1;
*/

DECLARE
  CURSOR C_PEDIDO IS
    SELECT CODPEDIDO, VALORDESCONTO
      FROM PEDIDO
        FOR UPDATE OF VALORDESCONTO;
  CURSOR C_ITEM (P_CODPEDIDO IN NUMBER) IS
    SELECT CODPEDIDO, VALORUNITARIO, QUANTIDADE, CODPRODUTO
      FROM ITEMPEDIDO
        WHERE CODPEDIDO = P_CODPEDIDO;
      TOTALDESCONTO PEDIDO.VALORDESCONTO%TYPE;
--  R_AUXILIAR C_PEDIDO%ROWTYPE;
BEGIN
-- COM LOOP
  FOR R_PEDIDO IN C_PEDIDO LOOP
    TOTALDESCONTO := 0;
--    DBMS_OUTPUT.PUT_LINE('CODIGO: ' || R_PEDIDO.CODPEDIDO);
    FOR R_ITEM IN C_ITEM(R_PEDIDO.CODPEDIDO) LOOP
      TOTALDESCONTO := TOTALDESCONTO + (R_ITEM.VALORUNITARIO * R_ITEM.QUANTIDADE * (R_ITEM.CODPRODUTO * 0.1 ));
--      R_ITEM.VALORUNITARIO * R_ITEM.QUANTIDADE;
--    DBMS_OUTPUT.PUT_LINE('    VALOR ITEM: ' || R_ITEM.VALORUNITARIO * R_ITEM.QUANTIDADE);
    END LOOP;
      UPDATE PEDIDO SET VALORDESCONTO = TOTALDESCONTO WHERE CURRENT OF C_PEDIDO;
  END LOOP;
-- SEM LOOP
/*
  OPEN C_PEDIDO;
  FETCH C_PEDIDO INTO R_AUXILIAR;
    DBMS_OUTPUT.PUT_LINE('CODIGO AUXILIAR: ' || R_AUXILIAR.CODPEDIDO);
  CLOSE C_PEDIDO;
*/
END;